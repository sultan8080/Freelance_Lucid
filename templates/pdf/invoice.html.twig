<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>{{ 'Invoice #'|trans }}{{ invoice.invoiceNumber }}</title>

        <style>
            @page {
                margin: 0;
            }
            body {
                margin: 0;
                padding: 0;
                font-family: 'Helvetica', 'Arial', sans-serif;
                font-size: 13px;
                color: #334155; /* Slate-700 */
                background: #ffffff;
                line-height: 1.5;
            }

            /* --- 1. BRAND COLORS --- */
            /* Blue: #2563eb | Purple: #7c3aed */

            .brand-bar {
                height: 8px;
                width: 100%;
                /* Gradient simulation for PDF */
                background: linear-gradient(90deg, #2563eb 0%, #7c3aed 100%);
            }

            .page-container {
                padding: 40px 50px;
            }

            /* Layout Helpers */
            .mb-4 {
                margin-bottom: 4px;
            }
            .mb-8 {
                margin-bottom: 8px;
            }
            .mb-20 {
                margin-bottom: 20px;
            }
            .mb-40 {
                margin-bottom: 40px;
            }

            .text-right {
                text-align: right;
            }
            .text-blue {
                color: #2563eb;
            }
            .text-purple {
                color: #7c3aed;
            }
            .text-slate {
                color: #64748b;
            }

            .font-bold {
                font-weight: bold;
            }
            .uppercase {
                text-transform: uppercase;
            }
            .small {
                font-size: 11px;
            }

            /* Header Typography */
            .invoice-title {
                font-size: 28px;
                font-weight: 800;
                color: #1e293b; /* Slate-900 */
                letter-spacing: -0.5px;
                line-height: 1;
            }

            .invoice-number {
                font-size: 16px;
                font-weight: 700;
                color: #2563eb; /* Brand Blue */
            }

            .section-title {
                font-size: 10px;
                font-weight: 700;
                color: #94a3b8; /* Slate-400 */
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-bottom: 8px;
                border-bottom: 1px solid #e2e8f0;
                padding-bottom: 4px;
            }

            .company-name {
                font-size: 15px;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 4px;
            }

            /* Tables */
            table {
                width: 100%;
                border-collapse: collapse;
            }
            td,
            th {
                vertical-align: top;
                padding: 0;
            }

            /* Items Table */
            .items-table {
                margin-bottom: 30px;
            }
            .items-table thead th {
                background: #eff6ff; /* Light Blue tint */
                color: #1e40af; /* Dark Blue text */
                font-size: 11px;
                font-weight: 700;
                text-transform: uppercase;
                padding: 12px 15px;
                text-align: left;
                border-bottom: 2px solid #dbeafe;
            }
            .items-table tbody td {
                padding: 12px 15px;
                border-bottom: 1px solid #f1f5f9;
                color: #334155;
            }
            .items-table .num {
                text-align: right;
            }
            .items-table .desc {
                font-weight: 500;
            }

            /* Totals Section */
            .totals-table td {
                padding: 6px 0;
            }
            .totals-table .label {
                color: #64748b;
                text-align: right;
                padding-right: 20px;
            }
            .totals-table .value {
                text-align: right;
                font-family: monospace;
                font-size: 14px;
            }

            .total-row td {
                border-top: 2px solid #e2e8f0;
                padding-top: 10px;
                padding-bottom: 10px;
            }
            .total-final {
                font-size: 20px;
                font-weight: 800;
                color: #7c3aed; /* Brand Purple */
            }

            /* Status Badges (Flattened for Print) */
            .status-box {
                display: inline-block;
                padding: 6px 12px;
                border-radius: 6px;
                font-size: 11px;
                font-weight: 700;
                text-transform: uppercase;
                margin-top: 10px;
            }
            .status-paid {
                background: #dcfce7;
                color: #166534;
                border: 1px solid #bbf7d0;
            }
            .status-sent {
                background: #dbeafe;
                color: #1e40af;
                border: 1px solid #bfdbfe;
            }
            .status-unpaid {
                background: #fef9c3;
                color: #854d0e;
                border: 1px solid #fef08a;
            }
            .status-draft {
                background: #f1f5f9;
                color: #475569;
                border: 1px solid #e2e8f0;
            }

            /* Footer */
            .footer {
                position: fixed;
                bottom: 40px;
                left: 50px;
                right: 50px;
                text-align: center;
                font-size: 11px;
                color: #94a3b8;
                border-top: 1px solid #f1f5f9;
                padding-top: 15px;
            }
        </style>
    </head>

    <body>
        <div class="brand-bar"></div>

        <div class="page-container">

            <table class="mb-40">
                <tr>
                    <td width="60%">
                        <div class="invoice-title">{{ 'INVOICE'|trans }}</div>

                        {# Status Badge #}
                        {% set statusClass = 'status-draft' %}
                        {% if invoice.status == 'PAID' %}
                            {% set statusClass = 'status-paid' %}
                        {% elseif invoice.status == 'SENT' %}
                            {% set statusClass = 'status-sent' %}
                        {% elseif invoice.status == 'UNPAID' or invoice.isOverdue %}
                            {% set statusClass = 'status-unpaid' %}
                        {% endif %}

                        <div class="status-box {{ statusClass }}">
                            {{ invoice.status|trans }}
                        </div>

                        {% if invoice.projectTitle %}
                            <div class="mt-16 text-slate small">
                                <strong>{{ 'Project:'|trans }}</strong>
                                {{ invoice.projectTitle }}
                            </div>
                        {% endif %}
                    </td>

                    <td width="40%" class="text-right">
                        <div class="small text-slate uppercase mb-4">{{ 'Invoice Reference'|trans }}</div>
                        <div class="invoice-number mb-20">#{{ invoice.invoiceNumber|default('DRAFT'|trans) }}</div>

                        <table style="width: auto; float: right;">
                            <tr>
                                <td class="text-right text-slate small" style="padding-right: 15px; padding-bottom: 5px;">{{ 'Issue Date:'|trans }}</td>
                                <td class="text-right font-bold small" style="padding-bottom: 5px;">
                                    {{ invoice.sentAt ? invoice.sentAt|date('d/m/Y') : 'Draft'|trans }}
                                </td>
                            </tr>
                            <tr>
                                <td class="text-right text-slate small" style="padding-right: 15px;">
                                    {% if invoice.status == 'PAID' %}{{ 'Paid Date:'|trans }}{% else %}{{ 'Due Date:'|trans }}
                                    {% endif %}
                                </td>
                                <td class="text-right font-bold small">
                                    {% if invoice.status == 'PAID' %}
                                        {{ invoice.paidAt ? invoice.paidAt|date('d/m/Y') : '-' }}
                                    {% else %}
                                        {{ invoice.dueDate ? invoice.dueDate|date('d/m/Y') : '-' }}
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>

            <table class="mb-40">
                <tr>
                    <td width="45%">
                        <div class="section-title">{{ 'From'|trans }}</div>
                        <div class="company-name">
                            {{ invoice.user.companyName|default(invoice.user.firstName ~ ' ' ~ invoice.user.lastName) }}
                        </div>
                        <div class="text-slate small" style="line-height: 1.6;">
                            {{ invoice.user.address|default('') }}<br>
                            {{ invoice.user.postCode|default('') }}
                            {{ invoice.user.city|default('') }}<br>
                            {{ invoice.user.country|default('') }}
                        </div>
                        <div class="text-slate small mt-8">
                            {{ invoice.user.email }}<br>
                            {% if invoice.user.siretNumber %}
                                SIRET:
                                {{ invoice.user.siretNumber }}
                            {% endif %}
                        </div>
                    </td>

                    <td width="10%"></td>

                    <td width="45%">
                        <div class="section-title">{{ 'Bill To'|trans }}</div>
                        <div class="company-name">
                            {{ invoice.frozenClientCompanyName|default(invoice.frozenClientName)|default('Client Name'|trans) }}
                        </div>
                        <div class="text-slate small" style="line-height: 1.6;">
                            {{ invoice.frozenClientAddress|default('') }}<br>
                            {{ invoice.frozenClientPostcode|default('') }}
                            {{ invoice.frozenClientCity|default('') }}<br>
                            {{ invoice.frozenClientCountry|default('') }}
                        </div>
                        <div class="text-slate small mt-8">
                            {% if invoice.frozenClientEmail %}
                                {{ invoice.frozenClientEmail }}<br>
                            {% endif %}
                            {% if invoice.frozenClientVat %}
                                {{ 'VAT:'|trans }}
                                {{ invoice.frozenClientVat }}
                            {% endif %}
                        </div>
                    </td>
                </tr>
            </table>

            <table class="items-table">
                <thead>
                    <tr>
                        <th width="50%">{{ 'Description'|trans }}</th>
                        <th width="10%" class="num">{{ 'Qty'|trans }}</th>
                        <th width="20%" class="num">{{ 'Price'|trans }}</th>
                        <th width="20%" class="num">{{ 'Total'|trans }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in invoice.invoiceItems %}
                        <tr>
                            <td class="desc">{{ item.description }}</td>
                            <td class="num">{{ item.quantity }}</td>
                            <td class="num">{{ item.unitPrice|number_format(2) }}</td>
                            <td class="num font-bold">{{ item.totalHt|number_format(2) }}</td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 20px; color: #94a3b8;">{{ 'No items.'|trans }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <table class="totals-table">
                <tr>
                    <td width="60%">
                        {% if invoice.totalVat == 0 %}
                            <div class="small text-slate" style="font-style: italic; max-width: 300px;">
                                {{ 'TVA non applicable, art. 293 B du CGI'|trans }}
                            </div>
                        {% endif %}
                    </td>
                    <td width="40%">
                        <table>
                            <tr>
                                <td class="label">{{ 'Subtotal (HT)'|trans }}</td>
                                <td class="value">{{ invoice.totalHt|number_format(2) }}
                                    {{ invoice.currency }}</td>
                            </tr>
                            <tr>
                                <td class="label">{{ 'VAT'|trans }}</td>
                                <td class="value">{{ invoice.totalVat|number_format(2) }}
                                    {{ invoice.currency }}</td>
                            </tr>
                            <tr class="total-row">
                                <td class="label" style="color: #1e293b; font-weight: bold;">{{ 'Total Amount'|trans }}</td>
                                <td class="value total-final">
                                    {{ invoice.totalAmount|number_format(2) }}
                                    {{ invoice.currency }}
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>

            <div class="footer">
                {{ 'Thank you for your business.'|trans }}<br>
                {{ 'Please use reference'|trans }}
                <strong>#{{ invoice.invoiceNumber|default('DRAFT'|trans) }}</strong>
                {{ 'for payment.'|trans }}
                {% if invoice.status != 'PAID' %}
                    <div style="margin-top: 8px; font-size: 8px; line-height: 1.1; color: #800080;">
                        {{ 'Late payment penalties: 10% interest plus a fixed recovery fee of â‚¬40 (B2B).'|trans }}<br>
                    </div>
                {% else %}
                    <div style="margin-top: 8px; font-size: 10px; font-weight: bold; color: #16a34a;">
                        {{ 'Invoice Paid, Thank you!'|trans }}
                    </div>
                {% endif %}
            </div>

        </div>
    </body>
</html>